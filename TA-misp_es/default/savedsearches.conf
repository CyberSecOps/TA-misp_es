[MISP_ES_ip_intel]
cron_schedule = 5 * * * *
dispatch.earliest_time = 
enableSched = 1
search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true geteventtag=true warning_list=true limit=0 last=1d\
| search misp_type=ip-*\
| eval ip=misp_value\
| eval description = misp_event_info."|".misp_category."|".misp_comment\
| eval weight = 1\
| table description,ip,weight\
| outputlookup misp_es_ip_intel

[MISP_ES_http_intel]
cron_schedule = 10 * * * *
dispatch.earliest_time = 
enableSched = 1
search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true geteventtag=true warning_list=true limit=0 last=1d\
| search misp_type=url\
| eval url=misp_url\
| eval http_user_agent=misp_user_agent\
| eval description = misp_event_info."|".misp_category."|".misp_comment\
| eval weight = 1\
| table description,http_referrer,http_user_agent,url,weight\
| outputlookup misp_es_http_intel

[MISP_ES_domain_intel]
cron_schedule = 15 * * * *
dispatch.earliest_time = 
enableSched = 1
search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true geteventtag=true warning_list=true limit=0 last=1d\
| eval domain=misp_domain\
| eval description = misp_event_info."|".misp_category."|".misp_comment\
| eval weight = 1\
| dedup domain description\
| table description,domain,weight\
| outputlookup misp_es_domain_intel


[MISP_ES_file_intel]
cron_schedule = 20 * * * *
dispatch.earliest_time = 
enableSched = 1
search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true geteventtag=true warning_list=true limit=0 last=1d\
| search misp_sha1=* OR misp_sha256=* OR misp_sha512=* OR misp_md5=* OR misp_ssdeep=* OR misp_filename=*\
| eval file_name=misp_filename\
| eval description = misp_event_info."|".misp_category."|".misp_comment\
| eval file_hash=mvappend(misp_sha1,misp_sha256,misp_sha512,misp_ssdeep,misp_md5)\
| mvexpand file_hash\
| eval weight = 1\
| table description,file_hash,file_name,weight\
| outputlookup misp_es_file_intel

[MISP_ES_registry_intel]
cron_schedule = 25 * * * *
dispatch.earliest_time = 
enableSched = 1
search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true  geteventtag=true warning_list=true limit=0 last=1d\
| search misp_type=regkey*\
| eval registry=split(misp_value,"|")\
| eval registry_value_name=mvindex(registry,0)\
| eval registry_value_text=mvindex(registry,1)\
| eval description = misp_event_info."|".misp_category."|".misp_comment\
| eval weight = 1\
| table description,registry_path,registry_value_name,registry_value_text,weight\
| outputlookup misp_es_registry_intel

[MISP_ES_email_intel]
cron_schedule = 30 * * * *
dispatch.earliest_time =
enableSched = 1
search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true geteventtag=true warning_list=true limit=0 last=1d\
| search misp_type=email-src OR misp_type=email-subject\
| eval src_user=misp_email_src\
| eval subject=misp_email_subject\
| eval description = misp_event_info."|".misp_category."|".misp_comment\
| eval weight = 1\
| table description,src_user,subject,weight\
| outputlookup misp_es_email_intel


# These searches do not neatly fit with indicators in MISP today. They can be modified as you see fit to meet your own MISP configuation.

#[MISP_ES_certificate_intel]
#enableSched = 1
#dispatch.earliest_time = 
#search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true geteventtag=true warning_list=true limit=0 last=1d\
#| eval user = {Placeholder for custom criteria}\
#| eval description = misp_event_info."|".misp_category."|".misp_comment\
#| eval weight = 1\
#| table certificate_issuer,certificate_subject,certificate_issuer_organization,certificate_subject_organization,certificate_serial,certificate_issuer_unit,certificate_subject_unit,description,weight\
#| outputlookup misp_es_certificate_intel

#[MISP_ES_user_intel]
#enableSched = 1
#dispatch.earliest_time = 
#search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true  geteventtag=true warning_list=true limit=0 last=1d\
#| eval user = {Placeholder for custom criteria}\
#| eval description = misp_event_info."|".misp_category."|".misp_comment\
#| eval weight = 1\
#| table description,user,weight\
#| outputlookup misp_es_user_intel

#[MISP_ES_service_intel]
#enableSched = 1
#dispatch.earliest_time = 
#search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true  geteventtag=true warning_list=true limit=0 last=1d\
#| eval service_file_hash = {Placeholder for custom criteria} \
#| eval description = misp_event_info."|".misp_category."|".misp_comment\
#| eval weight = 1\
#| table description,service,service_file_hash,service_dll_file_hash,weight\
#| outputlookup misp_es_service_intel

#[MISP_ES_process_intel]
#enableSched = 1
#dispatch.earliest_time = 
#search = | mispgetioc misp_instance=misp_covid add_description=true category="External analysis,Financial fraud,Internal reference,Network activity,Other,Payload delivery,Payload installation,Payload type,Persistence mechanism,Person,Social network,Support Tool,Targeting data" to_ids=true  geteventtag=true warning_list=true limit=0 last=1d\
#| eval process = {Placeholder for custom criteria} \
#| eval description = misp_event_info."|".misp_category."|".misp_comment\
#| eval weight = 1\
#| table description,process,process_file_name,weight\
#| outputlookup misp_es_process_intel
